<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body style="background-color: #C0C0C0;">

<!-- Add header styles to isolate it from the grid layout -->
<style>
  /* Body background color */
  body {
    background-color: #C0C0C0;
  }

  /* Header styles (remains the same as previous setup) */
  .site-header {
    background-color: #333;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: white;
  }

  .site-logo-link img {
    height: 50px;
    width: auto;
    margin-right: 15px;
  }

  .site-title {
    font-size: 24px;
    color: white;
    margin-right: auto;
    margin-left: 10px;
    text-decoration: none;
  }

  .site-nav a {
    color: white;
    margin: 0 10px;
    text-decoration: none;
    font-size: 18px;
  }

  /* Fixed 3-column layout for POI grid */
  .court-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 columns */
    gap: 20px;
    padding: 20px;
  }

  /* Card styles */
  .court-card {
    text-decoration: none;
    color: inherit;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s;
  }

  .court-card:hover {
    transform: translateY(-5px);
  }

  /* Image and title inside each card */
  .card-image {
    width: 100%;
    height: 150px;
    background-size: cover;
    background-position: center;
  }

  .card-title {
    padding: 10px;
    text-align: center;
    font-weight: bold;
    font-size: 16px;
  }

  /* Responsive design: adjust to fewer columns on small screens */
  @media (max-width: 768px) {
    .court-grid {
      grid-template-columns: repeat(2, 1fr); /* 2 columns on medium screens */
    }
  }

  @media (max-width: 480px) {
    .court-grid {
      grid-template-columns: 1fr; /* 1 column on small screens */
    }
  }
</style>

<!-- Header section -->
<header class="site-header">
  <div class="wrapper">
    <!-- Logo Image -->
    <a href="{{ "/" | relative_url }}" class="site-logo-link">
      <img src="{{ "/heritage-promotion/assets/images/Εφετεία.jpg" | relative_url }}" alt="{{ site.title }}" class="site-logo">
    </a>
    
    <!-- Site Title -->
    <a class="site-title" rel="author" href="{{ "/" | relative_url }}">{{ site.title | escape }}</a>

    {%- assign default_paths = site.pages | map: "path" -%}
    {%- assign page_paths = site.header_pages | default: default_paths -%}
    {%- assign titles_size = site.pages | map: 'title' | join: '' | size -%}

    {%- if titles_size > 0 -%}
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          {%- for path in page_paths -%}
            {%- assign my_page = site.pages | where: "path", path | first -%}
            {%- if my_page.title -%}
            <a class="page-link" href="{{ my_page.url | relative_url }}">{{ my_page.title | escape }}</a>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </nav>
    {%- endif -%}
  </div>
</header>

<!-- Main content container -->
<div class="content-container">
  <h2>Τα Εφετεία της Ελλάδας</h2>
  <p>Click για περισσότερες πληροφορίες</p>

  <div class="court-grid">
    {% for p in site.pois %}
      <a href="{{ p.url | relative_url }}" class="court-card" data-wikidatum="{{ p.wikidatum }}">
        <div class="card-image" id="image-{{ p.wikidatum }}"></div>
        <div class="card-title">{{ p.title }}</div>
      </a>
    {% endfor %}
  </div>
</div>

<!-- Fetch Title and Image from Wikidata -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  $('.court-card').each(function() {
    const wikidatum = $(this).data('wikidatum');
    get_wikidatum(wikidatum);
  });
});

function get_wikidatum(id) {
  let url = `https://www.wikidata.org/w/api.php?action=wbgetentities&ids=${id}&format=json&languages=en|el&origin=*`;
  $.getJSON(url, function(data) {
    const title = get_json_value(['entities', id, 'sitelinks', 'elwiki', 'title'], data);
    const image = get_json_value(['entities', id, 'claims', 'P18', 0, 'mainsnak', 'datavalue', 'value'], data);

    // Populate the title and image for each court card
    if (title) {
      $(`#title-${id}`).text(title);
    }

    if (image) {
      get_thumbnail(image, 300).then(thumbnailUrl => {
        $(`#image-${id}`).css('background-image', `url(${thumbnailUrl})`);
      });
    }
  });
}

function get_thumbnail(photoname, size) {
  return new Promise((resolve, reject) => {
    if (!photoname) return resolve('');  // Return empty if there's no image
    photoname = photoname.replace(/ /g, '_');
    const url = `https://api.wikimedia.org/core/v1/commons/file/File:${photoname}`;
    $.getJSON(url, function(data) {
      let thumbname = get_json_value(['thumbnail', 'url'], data);
      if (thumbname) {
        thumbname = thumbname.replace(/\/\d+px-/, `/${size}px-`);
        resolve(thumbname);
      } else {
        reject('Thumbnail not found');
      }
    }).fail(() => reject('Error fetching thumbnail'));
  });
}

function get_json_value(json_key, data) {
  try {
    while (json_key.length > 1) {
      data = data[json_key[0]];
      json_key = json_key.slice(1);
    }
    return data[json_key[0]];
  } catch (err) {
    console.error(err, json_key, JSON.stringify(data));
    return null;
  }
}
</script>
</html>
